.. methods::

Methods
=======

Enrichment of histone marks
---------------------------

The number of MNase reads supporting the position of a nucleosome is a confounding variable for the number of histone reads overlapping the same nucleosome. This may be due to position-specific properties of the genome, such as chromatin compactness or GC content, that results in local under-sampling of both MNAse and MNase ChIP-seq fragments. This process may introduced spurious signals of histone enrichment as some region may appear highly enriched compared with --otherwise equal-- under-sampled regions. A widely used correction method is to normalized the number of histone reads by the number of MNase reads. That's, on any given nucleosome, :math:`j`, the number of histone reads, :math:`x_j`, is normalized as the ratio:

.. math::

   r_j = \frac{ x_j } { n_j }

where :math:`n_j` is the number of MNase reads. 

This method assumes that :math:`x_j` is linearly dependent on :math:`n_j`. However, this may not be a accurate representation of their relation. In particular, is plausible to assume that the proportion of under-sampled genomic regions is more prevalent among nucleosomes with low values of :math:`n_j` than among nucleosomes with large values of :math:`n_j`. Under this assumption, we hypothesized that the expected value of :math:`x_j` should follow a rather saturation curve with respect to :math:`n_j`.

To take this effect into account, we normalized :math:`x_j` as:

.. math::

   r_j = \frac{ x_j } { E(X|n_j)}

where, :math:`E(X|n_j)` is the expected number of histone reads per nucleosome, :math:`X`, given :math:`n_j` supporting MNase reads. 

To test whether our normalization method is better than the classical one, we first check our hypothesis by computing :math:`E(X|n_j)` for the observed range of :math:`n_j` using all genomic nucleosomes (iNPs): 

.. math::

   E(X|n_j) = \frac{1}{||J(n_j)||} \sum_{j \in J(n_j)} x_j

Here, :math:`J(n_j)` is the subset of nucleosomes with :math:`n_j` supporting MNase reads. 

By compromising all genomic nucleosomes, :math:`E(X|n_j))` is not only unbias towards any position-specific biological function, but also tailors 1 as a reference point for :math:`r_j`: values of :math:`r_j` above and below 1 can be interpreted as enriched or depleted, respectively, of histone marks.

Additionally, since :math:`E(X|n_j)` is directly proportional to the total number of reads per histone library, the ratios :math:`r_j` are a metric already normalized by library size.

For each MNase ChIP-seq library, after removing outliers (read counts per nucleosome over 99% quantiles) :math:`E(X|n_j)` resulted (Figures 1-4) in monotonic transformations of the number of MNase reads per nucleosome. Interestingly, :math:`E(X|n_j)` saturates in the direction of the :math:`x`-axis, meaning that as the number of supporting of MNase reads gets larger its confounding effect on histone reads gets attenuated. By taking into account this effect, :math:`E(X|n_j)` improves the sensitivity of :math:`r_j` compared to the widely used method of using :math:`n_j` as denominator for :math:`r_j`. This difference is specially important among nucleosomes with large values of :math:`n_j`, where using :math:`n_j` as denominator for :math:`r_j` would otherwise over-amplifies the difference between their histone enrichment signals. 

These results support our hypothesis, and therefore favor the use of :math:`E(X|n_j)` over :math:`n_j` as denominators for :math:`r_j`.

The linear relationship between :math:`n_j` and :math:`x_j` would only holds when the proportion of under-sampled nucleosomes remains constant with respect to :math:`n_j`. If this may be the case for a particular library, :math:`E(X|n_j)` will be simply reduce to :math:`n_j`. Thus, :math:`E(X|n_j)` can be interpreted as general alternative to :math:`n_j` for cases when the proportion of under-sampled nucleosomes doesn't remain constant with :math:`n_j`.

.. figure::
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/17_H3K4me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/H3K4me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/n1_H3K4me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/n2_H3K4me3.expectedCounts.svg
   :width: 45%
Figure 1: Expected number of H3K4me3 reads given supporting MNase reads per nucleosome.

.. figure::
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/14_H3K27Ac.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/6_H3K27Ac.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/H3K27Ac.expectedCounts.svg
   :width: 45%
Figure 2: Expected number of H3K27Ac reads given supporting MNase reads per nucleosome.

.. figure::
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/4_H3K9me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/9_H3K9me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/H3K9me3.expectedCounts.svg
   :width: 45%
Figure 3: Expected number of H3K9me3 reads given supporting MNase reads per nucleosome.

.. figure::
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/12_H3K27me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/5_H3K27me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/H3K27me3.expectedCounts.svg
   :width: 45%
.. image:: https://132.239.135.28/public/nucChIP/files/methods/all_nucs/n3_H3K27me3.expectedCounts.svg
   :width: 45%
Figure 4: Expected number of H3K27me3 reads given supporting MNase reads per nucleosome.

Results using only high confidense nucleosomes can be seen here:

.. toctree::

   highQual_nuc.rst
